\documentclass[twoside,12pt]{article}

\usepackage{lmodern}
\usepackage[T1]{fontenc}
\usepackage[spanish,activeacute,es-tabla]{babel}
\usepackage{mathtools}
\usepackage{graphicx}
\usepackage[inner=3.0cm,top=2.5cm,outer=2.0cm,bottom=2.5cm]{geometry}  
\usepackage{fancyhdr}
\usepackage{hyperref}
\usepackage{multicol}
\usepackage{float}
\usepackage{eurosym}
\usepackage{datatool}
\usepackage{glossaries}
\usepackage{cite}

\pagenumbering{gobble}
%\renewcommand{\baselinestretch}{1.5}
\usepackage{setspace}
\onehalfspacing

\setlength{\footskip}{42pt}

\title{\begin{center} 
\includegraphics[width=0.8\textwidth]{images/upc-logo.png} 
\end{center} 
\vspace{0.5cm} 
Proyecto Final de Carrera\\
INGENIER\'IA INDUSTRIAL \\
\vspace{0.5cm} 
\Huge{
RosPiBot}
\vspace{0.5cm} \\
 Memoria}

\author{}
\date{} % void to avoid put current date
\pagestyle{fancy}

\fancyhead[LO,RE]{\title{RosPiBot}}
\fancyhead[LE,RO]{\thepage}
\fancyfoot[LE,RO]{\includegraphics[scale=0.5]{images/etseib-logo.png}}
\fancyfoot[C]{}
%\headrulewidth 0.4pt
%\footrulewidth 0 pt

%\makeglossaries
%\newacronym{IIC}{I$^{2}$C}{Inter-Integrated Circuit}
%\newacronym{SPI}{SPI}{Serial Protocol Interface}
%\newglossaryentry{electrolyte}{name=electrolyte, description={solution able to conduct electric current}}

\begin{document}
%\pagestyle{empty} 

\maketitle
\begin{center}
\large{$\begin{array}{ll}
\mbox{Autor:} & \mbox{Joan Guasch Iglesias} \\
\mbox{Director:} & \mbox{Manel Velasco Garcia} \\
\mbox{Convocatoria:} & \mbox{Fecha a presentar}
\end{array}$}\\ 
\vspace{2cm} 
\Large{Escuela T'ecnica Superior de Ingenier'ia Industrial de Barcelona}\\ 
\vspace{1cm}
\includegraphics[scale=1]{images/etseib-logo.png}
\end{center}
\thispagestyle{empty}
\newpage

\thispagestyle{empty}
\paragraph*{}
\newpage

%\thispagestyle{empty}
%\pagenumber{1}
\pagenumbering{arabic}
\fancyhead[LE,RO]{1} 

\normalsize
\begin{abstract}
Este proyecto consiste en el aprovechamiento de la plataforma rob'otica comercial WifiBot que corre el riesgo de quedarse obsoleta y rescatarla de su destino. Para ello se hace uso de una Raspberry Pi, un ordenador de placa reducida que ha revolucionado el mundo de la automatizaci'on desde el d'ia de su aparici'on en el 2012, como unidad de procesamiento de la nueva plataforma y que est'a basada en Linux. En el apartado de software, adem'as de incorporar herramientas que faciliten el trabajo a futuros usuarios se ha configurado para poder trabajar con ROS, una infrastructura digital para el desarrollo de software de robots creada por Willow Garage y extensamente utilizada en este sector.\\

A lo largo de este documento se exponen el estado inicial del robot, los nuevos requerimientos a cumplir, las modificaciones efectuadas incluyendo las complicaciones encontradas a lo largo del proyecto y el resultado final obtenido. Haciendo especial hincapi'e en el desarrollo de soluciones para cumplir los objetivos del proyecto, tales como el dise'no de circuitos electr'onicos, la integraci'on de los nuevos componentes o la creaci'on de una mejor interf'icie para el usuario. \\

\end{abstract}

%\thispagestyle{empty}
\newpage

\paragraph*{}
\thispagestyle{empty}
\newpage

\fancyhead[LE,RO]{3}
\tableofcontents
\setcounter{page}{1}
\addtocontents{toc}{~\hfill\textbf{P'agina}\par}
\addcontentsline{toc}{section}{Resumen}
%\setcounter{page}{1}
%\setcounter{page}{4}
\fancyhead[LE,RO]{4}
%\setcounter{page}{3}
%\addcontentsline{toc}{section}{'Indice}

\newpage
%\pagenumbering{arabic}
\setcounter{page}{5}
\fancyhead[LE,RO]{\thepage}
\listoffigures

\newpage
%\pagenumbering{arabic}
\setcounter{page}{6}
\fancyhead[LE,RO]{\thepage}
\listoftables

\newpage
%\pagenumbering{arabic}
\setcounter{page}{7}
\fancyhead[LE,RO]{\thepage}

\section*{Glosario}
\addcontentsline{toc}{section}{Glosario}
\begin{description}
\item[UART] Universal Asynchronous Receiver-Transmitter
\item[SPI] Serial Protocol Interface
\item[I${2}$C] Inter-Integrated Circuit
\item[ADC] Analog to Digital Converter
\item[SoC] System on a Chip
\item[CPU] Central Processing Unit
\item[GPU] Graphics Processing Unit
\item[RAM] Random Access Memory
\item[RCA] Random Access Memory
\item[HDMI] Random Access Memory
\item[DSI] Random Access Memory
\item[CSI] Random Access Memory
\item[GPIO] Random Access Memory
\item[SD] Random Access Memory
\end{description}

%\printglossaries


\newpage

\section{Introducci'on}

\subsection{Estado del arte}

\subsection{Alcance}


\subsection{Objetivos}

\newpage

\section{Descripci'on }

\subsection{WifiBot}
\textbf{Wifibot} es una plataforma rob'otica, desarrollada por la empresa francesa \textbf{Nexter Robotics}, dise'nada para poder navegar en m'ultiples escenarios gracias a su dise'no. Su sistema de tracci'on a las cuatro ruedas, dise'no reducido y bajo peso, le otorga una gran flexibilidad.

\subsubsection{Caracter'isticas}
Este proyecto parte del modelo \textbf{WifiBot 4G}, producido durante el periodo 2002--2006 y que a grandes rasgos incluye::

\begin{figure}[ht]
\centering
\includegraphics[scale=0.5]{images/Visuel_Wifibot_2.png} 
\caption{Wifi Bot 4G}
\label{fig:Wifi Bot 4G}
\end{figure}

\paragraph*{}

\begin{multicols}{2}
\begin{itemize}
\item CPU:
	\begin{itemize}
	\item Procesador AMD Au1500
	\item 400MHz
	\item Mem'oria RAM de 64MB
	\item Mem'oria Flash de 32MB
	\end{itemize}
\item Interf'icies:
	\begin{itemize}
	\item 4x Ethernet 10/100
	\item 1x USB
	\item 1x I$^{2}$C %\gls{IIC}
	\item 1x RS232
	\end{itemize}
\item WIFI:
	\begin{itemize}
	\item WiFi con est'andar 802.11a/b/g
	\item Modos Access Point, Bridge, Client y Router
	\item 1x Antena de 5dBi
	\end{itemize}
\item Sensores:
	\begin{itemize}
	\item 1x C'amara IP
	\item 2x Sensores IR de dist'ancia (ADC)
	\item 2x Codificadores 'optico de cuadratura 
	\item 2x DSPIC30F2010
	\item 1x Nivel de bater'ia (ADC)
	\end{itemize}
\item Motores:
	\begin{itemize}
	\item 4x Motores de 7.2V
	\item Reductora $i=50:1$
	\item Par nominal 8.87Kg/cm
	\item Velocidad nominal 120Rpm
	\end{itemize}
\item Dimensiones:
	\begin{itemize}
	\item Longitud 28cm
	\item Anchura 30cm
	\item Altura 20cm
	\item Peso 4.5Kg
	\end{itemize}
\item Bater'ias:
	\begin{itemize}
	\item 9.6V NiMh (8 celdas)
	\item Capacidad 9500mAh
	\item Autonom'ia de 2 horas
	\end{itemize}
\end{itemize}
\end{multicols}

\subsubsection{Estructura}

La estructura de la base est'a formada por dos secciones sim'etricas que llamaremos hemisferios izquierdo y derecho. Estas dos partes est'an unidas por una barra roscada que atraviesa transversalmente todo el robot, ofreciendo un eje de rotaci'on entre los dos elementos, cualidad que le otorga una mayor adaptaci'on a superf'icies irregulares.
%include image SolidWorks
%como vemos en figura \ref{fig:Wifi Bot 4G}

\subsubsection{Grupo Motriz}
Los motores que componen el WifiBot son concretamente el modelo \textbf{HN-GH7.2-2414T-50:1} del fabricante \textbf{Hsiang Neng}. Este modelo est'a compuesto por un motor de continua de voltaje nominal de 7.2V y una reductora con relaci'on 50:1. Tal y como se describe en la figura ~\ref{fig:Dimensiones del Motor}, dispone de un eje de 6mm de di'ametro, una longitud de 81.1mm y un di'ametro exterior de 37mm. 

\begin{figure}[ht]
\centering
\includegraphics[scale=0.35]{images/motor_dimensions.png} 
\caption{Dimensiones [mm] motor HN-GH7.2-2414T-50:1}
\label{fig:Dimensiones del Motor}
\end{figure}

En mediciones efectuadas, se determin'o que la alimentaci'on de los motores llegaba hasta los 8.2V con un consumo inferior a los 1.8A por motor (con carga), bas'andonos en la figura ~\ref{fig:Gr'afica del Motor}, podremos asegurar que el motor se encontraba ofreciendo un par de 4.7 Kg-cm. 

\begin{figure}[ht]
\centering
\includegraphics[scale=0.35]{images/motor_graph.png} 
\caption{Gr'afica de curvas espec'ificas del motor HN-GH7.2-2414T-50:1}
\label{fig:Gr'afica del Motor}
\end{figure}

\subsubsection{Codificador 'optico de cuadratura}
Este tipo de sensor permite conocer tanto la velocidad como la posici'on de un eje. Tal y como se describe en la figura ~\ref{fig:Esquema QEI} , su funcionamiento se basa en un disco ranurado que gira solidario al que se dispone un par de fototransistores. Estos transistores emiten una se'nal compuesta por dos canales, com'unmente llamados A y B, de onda cuadrada. Estos dos canales est'an desfasados un cuarto de fase, creando una secuencia que depende del sentido de giro. 

\begin{figure}[ht]
\centering
\includegraphics[scale=0.45]{images/encoderQEI.png} 
\caption{Esquema de funcionamiento de un encoder de cuadratura}
\label{fig:Esquema QEI}
\end{figure}

De los 4 motores que conforman la plataforma, los dos delanteros disponen de un codificador 'optico, concretamente el modelo \textbf{E4P-120-079-HT} del fabricante \textbf{US DIGITAL}. Este modelo ofrece unos 120 ciclos por revoluci'on (o 480 interrupciones), est'a pensado para ejes de 2mm de di'ametro y no dispone de canal de 'indice (permite corregir errores). Tras un ensayo del motor sin carga, cuyos datos se encuentran en la tabla ~\ref{tab:Encoder periods}, se determin'o que se llegaba a un m'aximo de 80.000 pulsos por segundo.\\

\begin{table}[ht]
\begin{center}
\begin{tabular}{|c|c|c|}
	\hline
	\textbf{Voltaje [V]} & \textbf{Consumo [A]} & \textbf{Per'iodo de Cuadratura [us]} \\ \hline
	0.5 & 0.07 & 2200 \\ \hline
	1.0 & 0.08 & 1000 \\ \hline
	1.5 & 0.09 & 320 \\ \hline
	2.0 & 0.10 & 220 \\ \hline
	2.5 & 0.11 & 170 \\	\hline
	3.0 & 0.11 & 140 \\ \hline
	3.5 & 0.12 & 120 \\ \hline
	4.0 & 0.12 & 100 \\ \hline  
	4.5 & 0.13 & 90 \\ \hline  
	5.0 & 0.13 & 80 \\ \hline
	5.5 & 0.14 & 70 \\ \hline
	6.0 & 0.15 & 65 \\ \hline
	6.5 & 0.15 & 60 \\ \hline
	7.0 & 0.15 & 55 \\ \hline
	7.5 & 0.16 & 50 \\ \hline

\end{tabular}
\end{center}

\caption{Ensayo de consumo y se'nal de codificador del motor sin carga }
\label{tab:Encoder periods}
\end{table}

\subsubsection{Estado Inicial}  
La plataforma de la que se dispon'ia en un principio carec'ia de cierta cualidades. La m'as destacable era la inestabilidad de la red WiFi, dicha conexi'on sufr'ia constantes ca'idas con lo que dificultaba enormemente su teleopraci'on. Su otro tal'on de Aquiles era su escasa documentaci'on disponible, al ser un producto que su fabricante da por descontinuado y al no disponer de una comunidad que lo mantenga, dicha base rob'otica provocaba quebraderos de cabeza para usuarios noveles. Finalmente, las bater'ias al haber completado su vida 'util, dispon'ian de una carga efectiva muy inferior a la inicial. En cambio, tanto la estructura, ruedas, motores y sensores se encontraban en mejores condiciones\\
\newpage

\subsection{Raspberry Pi}
Raspberry Pi es un ordenador del tama'no de una tarjeta de cr'edito desarrolado en Reino Unido por la \textbf{Raspberry Pi Foundation} con el objetivo de fomentar las bases de la computaci'on en escuelas. El desarrollo de este diminuto ordenador empez'o en el 2006 hasta alcanzar su madurez y comercializaci'on en Febrero del 2012. 

\begin{figure}[ht]
\centering
\includegraphics[scale=0.2]{images/raspi.png} 
\caption{Raspberri Pi}
\label{fig:Raspberry Pi}
\end{figure}

\subsubsection{Caracter'isticas}
Aunque existen varios modelos de Raspberry Pi, este proyecto se basa en el modelo B (segunda revisi'on). Este modelo se caracteriza por:

\begin{figure}[ht]
\centering
\includegraphics[scale=0.15]{images/RaspiModelB.png} 
\caption{Esquema Modelo B}
\label{fig:Esquema Modelo B}
\end{figure}

%\begin{multicols}{2}
\begin{itemize}
\item Procesador Broadcom BCM2835 (SoC) compuesto por:
	\begin{itemize}
	\item CPU: ARM1176JZF-S (Arquitectura ARM 11)
	\item GPU: VIDEOCORE IV (250 Mhz)
	\item Mem'oria RAM de 512MB
	\end{itemize}
\item Connexiones multimedia:
	\begin{itemize}
	\item 1x Entrada de v'ideo: CSI
	\item 3x Salidas de v'ideo: RCA, HDMI y DSI
	\item 2x Salida de audio: 3.5mm jack y HDMI
	\item 1x RS232
	\end{itemize}
\item Connexiones de datos:
	\begin{itemize}
	\item 1x Ranura tarjeta SD (Disco Duro)
	\item 2x Puertos USB 2.0
	\item 1x Puerto Ethernet RJ45 (10/100 MBit/s)
	\end{itemize}
\item Perif'ericos de bajo nivel:
	\begin{itemize}
	\item 8x GPIO
	\item 1x UART
	\item 1x I$^{2}$C bus
	\item 1x SPI bus (dos pines de selecci'on)
	\end{itemize}
\item Otros datos:
	\begin{itemize}
	\item Alimentaci'on: 5V via MicroUSB o GPIO
	\item Medidas: 85.6mm x 56mm
	\item Peso: 45 g
	\end{itemize}
\end{itemize}
%\end{multicols}

\newpage
\section{Especificaciones}
Tal y como se ha definido anteriormente, el objetivo de este proyecto consiste en ofrecer una plataforma funcional para los futuros usuarios. Para definir esta ''funcionalidad'' se ha basado en el conocimiento aportado por antiguos usuarios, trabajadores en productos similares y en la experiencia propia. \\

Las especificaciones se han clasificado seg'un su or'igen. Dependiendo de si son de car'acter \textbf{software}, \textbf{electr'onico} o \textbf{mec'anico}. Las especificaciones de car'acter inform'atico engloban aspectos como la interf'icie con el usuario, las herramientas de desarrollo (librer'ias, documentaci'on) y la disponibilidad a futuras modificaciones. Por contra, la electr'onica ha de evitar que el usuario se encuentre obligado a manipular el interior del robot, pero que en el caso de dicha situaci'on permita una soluci'on simple del problema. Adem'as, la electr'onica ha de incorporar un sistema que permita conocer estados del robot de manera sencilla. Finalmente, la mec'anica se encarga de incorporar las nuevas especificaciones en la plataforma, manteniendo el concepto inicial. Igual que en la electr'onica, en el caso de una futura manipulaci'on por parte del usuario, el dise'no ha de facilitar el acceso a cualquier ubicaci'on.

\subsection{Software}
El principal requisito del software es ofrecer un acceso simple al usuario. Teniendo presente el hecho que pueda ser utilizado tanto para usuario noveles como para usuarios experimentados. Por ello se ha planteado las siguientes especificaciones.

\subsubsection{Web}
Se ofrecer'a un servidor web que permita de visualizar f'acilmente el estado del robot como por ejemplo: el nivel de carga de bater'ias, sensores de proximidad, velocidad de desplazamiento, consumo de motores, etc. Adem'as se incluir'a una pantalla d'onde se monitorizar'a una c'amara que incorpora el robot y un par de terminales de comandos.
En otro apartado de la web se ofrecer'a la descarga de todos aquellos documentos necesarios para el usuario, evitando as'i que el usuario pierda tiempo en la b'usqueda de la documentaci'on.

\subsubsection{Librer'ias}
%Por facilidad de uso y comodidad se ha decidido que todo el software utilizado en este proyecto se base en $Python^{ TM}$, un lenguaje de programaciÃ³n
Para aquel desarrollador que decida utilizar esta plataforma se le ofrecer'a un conjunto de librer'ias que permitan trabajar con el robot de manera comoda. Estas librer'ias se compondr'an de una sintaxis limpia y un c'odigo legible que proporcinar'a una f'acil interpretaci'on.    

\subsection{Electr'onica}
El objetivo de la electr'onica es ser la parte m'as vital de la plataforma, pero pasando desapercibida por el usuario. Ofreciendo una m'inima interacci'on pero suficiente para comprender el estado del robot. Esta interacci'on se har'a mediante se'nales luminosas o ac'usticas, e indicar'an los siguientes estados.

\subsubsection{Funcionamiento}
En la plataforma de partida no se dispone de ning'un medio que indique si se encuentra operativo, por ello la primera especificaci'on de la parte electr'onica ser'a la incoporaci'on de un se'nal luminosa que muestre si el robot est'a encendido o apagado. Tambi'en existe la posibilidad de ofrecer informaci'on de otros estados.

\subsubsection{Alimentaci'on}
Las bater'ias ofrecer'an  una autonom'ia suficiente para moverse en un entorno exterior, se estipula un m'inimo de 2 horas en movimiento como m'inimo aceptable. Adem'as de la duraci'on, su recarga deber'a de ser lo m'aximo de comodo para el usuario, evitando que tenga que manipular las celdas de energ'ia. Se recomienda elementos de seguridad ante problemas como sobrecargas o cortocircuitos y de gesti'on de energ'ia para aumentar la vida 'util.\\

Otro punto a tener en cuenta es la disponibilidad en encontrar repuestos de la bater'ia, por ello se usar'an productos comerciales f'aciles de adquirir. Finalmente, se monitorizar'a el nivel de carga a partir de unos elementos luminosos.

\subsubsection{L'ogica}
Para el control de la plataforma el proyecto se ha basa en uso de la Raspberry Pi. Dicho ordenador ser'a el responsable de efectuar todo los c'alculos y 'ordenes, A'un as'i, a causa de sus limitaciones se precisa de una l'ogica complementaria capaz de gestionar y contabilizar las lecturas anal'ogicas de los sensores, el control de motores, la comunicaci'on externa y la distribuci'on de energ'ia.

\subsubsection{Comunicaci'on}  
Para poder interaccionar con el plataforma rob'otica se proponen 3 medios alternativos. Cada uno de estos canales permitir'an el acceso al usuario. Un primer medio ser'a por via cableada, a partir de un cable de red, los otros dos ser'an por via inal'ambrica, por un lado se buscar'a un red Wi-Fi predefinida y por otro se crear'a una red Wi-Fi propia. 

\subsection{Mec'anica}
Se intentar'a en la medida de lo posible mantener la silueta caracter'istica del robot, asignando mayor prioridad a aquellas modificaciones motivadas por software o  electr'onica. 

\subsubsection{Estructura}
Se desea mantener la estructura b'asica de la plataforma, dejando su peculiar forma de dos bloques unidos por una barra roscada longitudinal. Se mantendr'a el concepto de perfiles cuadrados como elemento estructural pero modificando la separaci'on entre ellos.La ubicaci'on de los distintos elementos se dispondr'an seg'un su relaci'on con el resto de dispositivos, uniendo seg'un se traten de control de potencia, l'ogica o comunicaci'on.


\subsubsection{Tornilleria}
A causa del deterioro de los elementos de tornilleria se proceder'a a cambiar el roscado de todos los tornillos por uno m'as estandarizado como el m'etrico. Este cambio tambi'en incluye las barras estructurales, los adaptadores de los ejes y los prisioneros



\newpage
\section{Modificaciones}
Para la realizaci'on de este proyecto se deber'a trabajar en varios sectores. Debido que el software es el sector que permite mejor adaptarse a los nuevos cambios y que la mec'anica de la plataforma proporciona cierta flexibilidad, el componente electr'onico ser'a el que ofrezca las mayores limitaciones. Por ello se considera que los primeros esfuerzos deber'an centrarse en este sector, aprovechando al m'aximo los recursos ya existentes.


Aunque la platafoma inicial segu'ia funcionando, los problemas derivados de su desgaste propiciaron la necesitad de modificar en gran medida su interior. En un principio de demostr'o que simplemente insertando una Raspberry Pi, conectada mediante puerto ethernet, se pod'ia comandar el robot. Tambi'en fu'e posible acceder a datos b'asicos del robot como el estado de las bater'ias o la lectura de los sensores de proximidad. Pero el hecho de la inestabilidad de su unidad de procesamiento hizo necesaria su subtituci'on completa. A causa de a esta decisi'on, se tuvo que buscar el modo de comunicarse con los dem'as componentes ya existentes: etapa de alimentaci'on, gestor de bater'ias, control de motores y lectura de sensores. 

\subsection{ Componentes Electr'onicos}
Para poder actuar con cada dispositivo, el robot hac'ia uso de las interf'icies de comunicaci'on UART e I$^{2}$C; Pero a'un sabiendo el protocolo empleado, la comprensi'on de la informaci'on que circulaba fu'e pr'acticamente imposible. Por ello se determin'o que para poder proseguir con el proyecto hac'ia falta el desarrollo de nuevos componentes que substituyesen a los actuales y que permitiesen a futuros usuarios comprender r'apidamente que protocolos se utilizan y c'omo interaccionar con ellos. A continuaci'on se detallan los componentes utilizados.

\subsubsection{Motorizaci'on}
Debido al buen estado de los motores y del hecho que un par incorpora codificadores de cuadratura, se ha optado por mantener estos motores. Con este gesto evitamos la b'usqueda de su substituto y nos aseguramos que se mantenga la misma funcionalidad que al inicio. Al conservar este dispositivos se considera que el consumo (por lo que afecta a la parte de motorizaci'on) permanecer'a semejante, por tanto la nueva etapa de control de motores dispondr'a de caracterÃ­sticas similares. Siendo el voltaje nominal del grupo motriz de unos 7.2 se requiere de una alimentaci'on acorde a este voltaje; En el caso de utilizar bater'ias de voltaje superior, ser'a necesario una etapa DC-DC para adecuar los niveles.


\subsubsection{Sensores de proximidad}
Cualquier plataforma rob'otica dedicada a la exploraci'on ha de disponer de sensores que les proporcionen informaci'on sobre el mundo que le rodea. Por ello se aprovechar'an los sensores anal'ogicos infrarrojos actuales del robot, Sharp GP2Y0A2YK, y se an'adir'an cuatro nuevos sensores por ultrasonidos KS103.\\

\begin{figure}[ht]
\centering
\includegraphics[scale=0.40]{images/KS103.png}
\caption{Sensor de distancia por ultrasonidos KS103}
\label{fig:KS103}
\end{figure} 

Las caracter'isticas de este sensor han sido el motivo de su elecci'on: Su gran rango de medida (de 1cm a 550cm), una resoluci'on de 1mm, comunicaci'on via I${^2}$C (con 20 direcciones possibles), capaz de operar de 3.0 a 5.5V y permite hasta unas 500 lecturas por segundo. Otro factor que se ha tenido en cuenta es el hecho que la luz de sol en determinadas circunstancias puede afectar a la lectura real de los sensores infrarrojos, en cambio los sensores de ultrasonidos no quedan afectados.\\

\begin{figure}[ht]
\centering
\includegraphics[scale=0.20]{images/KS103_diagram.png}
\caption{Diagrama de radiaci'on del sensor KS103}
\label{fig:KS103_diagram}
\end{figure} 

El funcionamiento de este tipo de sensor de basa en el envi'o de un pulso y la recepci'on de su eco, luego el propio sensor determina el tiempo entre estos dos sucesos y calcula la distancia a la que se encuentra el obst'aculo. Debido a que los ultrasonidos producidos pueden afectarse entre ellos si se realiza una lectura simult'anea, se deber'a esperar la finalizaci'on de la lectura de un sensor para activar el siguiente. 



\subsubsection{Bater'ia}
Para la selecci'on del sistema de acumulaci'on de energ'ia se ha barajado diferentes posibilidades que podemos encontrar en el mercado:Bater'ias de plomo, NiCd, NiMH, Ion Litio y Pol'imero de Litio (LiPo). Las de plomo han sido las primeras descartadas a causa de su baja densidad de carga y su elevado peso. Las constituidas por elementos de NiCd se encuentran en fase de desaparici'on por experimentar el efecto mem'oria (reducci'on de su capacidad al cabo del tiempo) y ser superadas por sus competidoras. Las bater'ias de Ion de Litio, a'un disponiendo de una alta densidad de carga y bajo peso (motivo de su extendido uso en dispositivos m'obiles), no son capaces de ofrecer una gran capacidad de descarga. \\

\begin{table}[ht]
\begin{center}
\begin{tabular}{|c|c|c|}
	\hline
	\textbf{Tipo} & \textbf{Densidad de carga} & \textbf{Densidad de potencia} \\ 
	\textbf{ } & \textbf{[Wh/Kg]} & \textbf{[W/Kg]} \\	\hline
	NiCd & 50 & 600 \\ \hline
	NiMh & 70 & 700 \\ \hline
	Li-Ion & 220 & 300 \\ \hline
	Li-Poly & 150 & 2690 \\ \hline

\end{tabular}
\end{center}

\caption{Comparativa entre tipos de bater'ias }
\label{tab:Battery_type_table}
\end{table}

Llegados a este punto queda decidir entre las bater'ias constituidas por NiMH o LiPo. Ambas bater'ias est'an ampliamente comercializadas y ofrecen una alta capacidad de descarga si se comparan con las descartadas. Aunque las LiPo disponen de mejores caracter'isticas, seg'un la tabla \ref{tab:Battery_type_table}, se corre el riesgo de que  lleguen a incendiarse si se sobrecargan o que queden inutilizadas si se alcanza un voltaje inferior de 2.5V por celda.\\

\begin{figure}[ht]
\centering
\includegraphics[scale=0.4]{images/Lipo_PCM.png} 
\caption{Bater'ia LiPo con PCM instalado}
\label{fig:LiPo_PCM}
\end{figure} 

Por ello se ha optado por el uso de unas bater'ias con un m'odulo PCM instalado, este peque'no dispositivo ofrece un control sobre la bater'ia, protegi'endola de sobredescargas y gestionando su carga. Adem'as ya no hace necesario cargadores espec'ificos, simplemente una fuente de tensi'on acorde. Debido a que los motores tienen un voltaje nominal de 7.2V, se ha decidido el uso de bater'ias de 7.4V, estas bater'ias tienen un rango de funcionamiento de 2.75 hasta los 4.2V. \\

Finalmente las la bater'ia elegidas ha sido un conjunto formado por dos celdas de 3.7V de 6000mAh cada una conectadas en serie y con un modulo PCM instalado. Su consumo de carga llega a los 2A y a unos 6A en descarga.

\subsubsection{Punto de acceso WiFi} \label{sec:router}
Tal y c'omo se ha descrito en las especificaciones, se requiere de una sistema que ofrezca un acceso WiFi. Debido a que se ha descartado el uso del m'odulo que ya dispo'ia el robot, se hace necesario un nuevo dispositivo que se encargue. En este caso de ha optado por el uso de un elemento comercial de tama'no reducido que se pueda alimentar f'acilmente, ofezca un alcance aceptable y de r'apida configuraci'on.

\begin{figure}[ht]
\centering
\includegraphics[scale=0.15]{images/TL-WR702N.png} 
\caption{Router TP-Link WR702N}
\label{fig:TL-WR702N}
\end{figure}

El dispositivo elegido se trata del mini router TL-WR702N de la empresa TP-LINK. Este modelo ofrece una velocidad m'axima de transmisi'on de 150Mbps, se alimenta mediante un puerto MicroUSB (5V) y dispone de un puerto ethernet RJ45, que dependiendo del modo de trabajo se comporta como un puerto WAN o LAN.\\

Entre todas sus configuraciones (AP Mode, Router Mode ,Client Mode,
Repeater Mode y  Bridge Mode) se ha optado por la de punto de acceso con el nombre de RosPiBot y servidor DHCP activado. De esta manera el usuario s'olo deber'a conectarse a su red para poder acceder al robot.

\subsubsection{Conmutador de red}
Seg'un las especificaciones se desea que la nueva plataforma disponga de tres medios de acceso a red. Dos de estos medios (Wifi y clavija ethernet) han de estar conectados directamente con el puerto ethernet de la Raspberry, por este motivo se necesita un conmutador o switch. Puesto que el robot ya dispone de un switch de 5 puertos (4 habilitados), se aprovechar'a el mismo dispositivo.\\

\begin{figure}[ht]
\centering
\includegraphics[scale=0.35]{images/switch_comparative.png} 
\caption{Switch antes y despu'es de la modificaci'on}
\label{fig:switch_comparative}
\end{figure}

Debido a que el conector que dispone el switch implica una que el conector se encuentre en posici'on horizontal, se ha optado por la substituci'on de la clavija de cuatro puertos por tres verticales, de esta manera se reduce la superf'icie que requiere el switch con los conectores.

\subsubsection{Descodificador de cuadratura} \label{sec:LS7366}
Uno de los elementos m'as 'utiles que podemos encontrar en la plataforma es la existencia de dos codificadores de cuadratura dispuestos en el grupo motriz delantero (uno a cada lado). Estos dispositivos permiten medir los cambios del eje del motor (antes de la etapa reductora) con gran precisi'on. Para su funcionamiento requieren de una alimentaci'on de 5 voltios, siendo este mismo voltaje el usado en la salida del se'nal. Debido a su voltaje, superior a los 3.3 voltios que soportan los pines de la Raspberry Pi, se hace necesario un adaptador de nivel. Adem'as, seg'un los resultados experimentados, la frecuencia m'axima de interrupciones generadas por el codificador llega hasta las 80.000 por segundo, Haciendo imposible que el microprocesador sea capaz de gestionarlo.

\begin{figure}[ht]
\centering
\includegraphics[scale=0.15]{images/LS7366.png} 
\caption{Diagrama de pines LS7366}
\label{fig:LS7366}
\end{figure} 

Para solventar el problema, se hace uso del circuito integrado LS7366, un contador de cuadratura de hasta 32 bits con interf'icie SPI. Este componente incrementa o decrementa un contador interno dependiendo de la secuencia que proviene del codificador de cuadratura. Adem'as en el momento que se quiera acceder al registro de dicho contador, el circuito procede a copiar el estado de contador en un segundo registro, permitiendo que la lectura no interfiera con el c'omputo.\\

Gracias a este integrado, se evita que el microprocesador tenga que hacerse cargo del gran nombre de interupciones, permiti'endole dedicarse a otros procesos. Para la comunicaci'on se aprovecha el m'odulo propio SPI del BCM2835 y dos de los pines de selecci'on de escalvo. 

\subsubsection{Adaptador de nivel de tensi'on}

\begin{figure}[ht]
\centering
\includegraphics[scale=0.30]{images/level_shifter_circuit.png}
\caption{Circuito adaptador de tensi'on}
\label{fig:Level_shifter_circuit}
\end{figure} 

\begin{figure}[ht]
\centering
\includegraphics[scale=0.30]{images/bss138_diagram.png}
\caption{Diagrama BSS138}
\label{fig:BSS138}
\end{figure} 

Para una correcta comunicaci'on entre los diferentes dispositivos es preciso adaptar los diferentes voltajes. Para ello hay que tener en cuenta en que rangos cada dispositivo se comunica; Mientras que la Raspberry Pi usa voltajes en su GPIO de 0 a 3.3V, el controlador de motores opera con tensiones superior a los 4.5V.\\

Debido a que algunos pines requieren bidirecionalidad (por ejemplo I${^2}$C) se ha decantado por el uso del circuito recomendado por la empresa \textbf{Philips Semiconductors} explicado en su documento \textbf{AN97055} y que corresponde a la figura \ref{fig:Level_shifter_circuit}. Finalmente para el circuito se utilizar'an resistencias de 10K$\Omega$ para la funci'on de ''pull-up'' y el mosfet de canal N \textbf{BSS138} como el de la figura \ref{fig:BSS138}.



\subsubsection{Lectura de valores anal'ogicos}


Debido al uso de sensores de salida anal'ogica (sensores de distancia por infrarrojos), el uso de resistencias Shunt y la monitorizaci'on de bater'ias, se requiere una lectura anal'ogica. Por ello se utilizar'a un conversor anal'ogico a digital o ADC ya que la Raspberry no dispone de uno propio. De los posibles componentes que cumplan esta funci'on se ha elegido aquel que de comunique por I$^{2}$C, ofrezca una resoluci'on aceptable, haya sido utilizado satisfactoriamente por otros usuarios y de menor coste. El componente elegido ha sido el MCP3428, un conversor ADC Sigma-Delta de 4 canales diferenciales, resoluci'on de hasta 16 bits y voltaje de referencia interno de 2.048 voltios.

\begin{figure}[ht]
\centering
\includegraphics[scale=0.30]{images/MCP3428_pin_diagram.png}
\caption{Diagrama de pines MCP3428}
\label{fig:MCP3428}
\end{figure} 


\subsubsection{Monitorizaci'on de la Bater'ia}
Conocer el estado de la bater'ia en cualquier momento es crucial en plataformas m'oviles, por ello su monitorizaje es imprescindible. Dicho monitorizaje se efectua de dos maneras distintas: La primera mediante un m'odulo ADC que digitaliza el estado de la bater'ia, y la segunda utiliza el circuito integrado LM3914, un dispositivo encargado de medir el voltaje y mostrar dicha informaci'on mediante LEDs.

\begin{figure}[ht]
\centering
\includegraphics[scale=0.30]{images/LM3914_pin_diagram.png}
\caption{Diagrama de pines LM3914}
\label{fig:LM3914}
\end{figure} 

\subsubsection{Alimentaci'on de l'ogica}
A causa de los diferentes niveles de tensi'on entre la bater'ia que cada componente requiere, se hace necesario un sistema que lo adecue; Por ello se ha dedicido usar un regulador que ofrezca una salida estable de 5 voltios. En el caso de la Raspberry Pi se utilizar'a el propio regulador interno de 5 a 3.3V.
A partir de experimentaciones previas se estima un consumo medio de 1500mA. Para satisfacer dicho consumo es necesario un regulador de alta eficiencia, y debido a que siempre nos encontramos la situaci'on de reducir el voltaje, deberemos usar un convertidor Buck. 

\begin{figure}[ht]
\centering
\includegraphics[scale=0.35]{images/LM2596.png}
\caption{Circuito regulador Buck 5V}
\label{fig:LM2596}
\end{figure} 

El componente elegido ha sido el LM2596, un regulador capaz de ofrecer hasta 3A. Su elecci'on se ha basado en el tipo de componentes que requiere, su facilidad de uso, su coste total reducido y la experiencia previa con este regulador. Para la selecci'on de componentes, la mayor'ia vienen definidos por el propio fabricante, excepto la bobina, la  cual para obtener el m'aximo rendimiento del regulador su inductancia se ha de elegir seg'un la figura \ref{fig:Bobina_Graph}. Puesto que las bater'ias oscilan de 6 a 8.4V y que el consumo var'ia de 1 a 2A, se ha coloreado de verde claro aquellas zonas en la que el regulador puede llegar a trabajar y de color m'as oscuro la zona m'as t'ipica d'onde se puede encontrar. Por esto motivo se ha elegido el valor de 22 $\mu$H.

\begin{figure}[ht]
\centering
\includegraphics[scale=0.30]{images/bobina_graph.png}
\caption{Guia de selecci'on de inductancia}
\label{fig:Bobina_Graph}
\end{figure} 

\subsubsection{Control de motores} \label{sec:L298N}
Para el control de motores se utilizar'a el mismo componente L298 usado en el robot original, un doble puente en H . Este dispositivo permite un control independiente de dos motores de cont'inua hasta un consumo de 2 amperios por motor.\\

\begin{figure}[ht]
\centering
\includegraphics[scale=0.25]{images/L298_pin_diagram.png}
\caption{Diagrama de pines L298N}
\label{fig:L298N}
\end{figure} 

El sentido de rotaci'on se dirige a partir de dos pines indicados como ''Inputs'' y la velocidad mediante una se'nal PWM en el pin de ''Enable''. Aunque dispone de una salida para conocer la intensidad que circula por cada canal (se conecta en serie una resistencia Shunt y se mide la diferencia de potencial), no dispone de ning'un sensor para saber la velocidad del motor.

\subsection{Integraci'on de los componentes}
Los componentes descritos anteriormente desde los puntos \ref{sec:LS7366} hasta \ref{sec:L298N} requieren de ser montados en una PCB. Para ello se han dise'nado un conjunto de placas, se han enviado a producir y finalmente se han ensamblado los componentes manualmente.\\

Para la producci'on de las PCB se ha utilizado un servido de prototipado de bajo coste pero con la limitaci'on que los dise'nos han de estar contenidos en rect'angulos de 5x5, 5x10 o 10x10cm. Aunque posiblemente se pudiera incluir todos los componentes en un solo circuito impreso de 10x5cm, se ha preferido crear 3 dise'nos de 5x5cm. As'i se reduce el riesgo de deshacerse de toda una placa por culpa de un imperfecci'on en un componente y se da modularidad al sistema. Las placas creadas s'on: SecurePi, SensorPi y MotorPi.

\subsubsection{SecurePi}
Esta placa tiene dos objetivos: Ofrecer una etapa de regulaci'on para la alimentaci'on de todos aquellos elementos que requieran una alimentaci'on de 5V y proteger todos los pines GPIO de la Raspberry Pi (ofreciendo bidirecionalidad y convirtiendo el voltaje de 3.3 a 5V).

\begin{figure}[ht]
\centering
\includegraphics[scale=0.60]{images/SecurePi_comparation.png}
\caption{Layout y PCB de la placa SecurePi}
\label{fig:SecurePi_comparation}
\end{figure} 

Otra caracter'istica de esta placa es la redistribuci'on de los pines, separados seg'un la funcionalidad de cada uno. Podemos observar como el conector de 26 pines se ha distribuido en varios: UART(x2), GPIO(x8), SPI(x5), I2C(x2) y alimentaci'on (GND, 3.3V y 5V).\\

Tal y como se aprecia en la figura \ref{fig:SecurePi_mounted}, una vez montada la SecurePi encima de la Raspberry, el usuario puede seguir accediendo a los pines directos del GPIO, usar las nuevas salidas elevadas a 5V y decidir si alimentar el dispositivo mediante el puerto MicroUSB o con una fuente de mayor tensi'on mediante el conector Jack de 5.1mm.

\begin{figure}[ht]
\centering
\includegraphics[scale=0.40]{images/SecurePi_mounted.png}
\caption{SecurePi colocada con la Raspberry Pi}
\label{fig:SecurePi_mounted}
\end{figure} 

\subsubsection{SensorPi}
Sobre la placa SecurePi se coloca la SensorPi, esta placa dispone de los descodificadores de cuadratura, los conversores anal'ogicos y un conjunto de leds (uno verde para indicar la correcta alimentaci'on y ocho 'ambar para los pines GPIO destinador a al control de motores).\\

Para cada uno de los descodificadores se han dispuesto de dos tiras de tres pines que disponen de alimentaci'on (GND y 5V), dos canales de cuadratura y un pin opcional para el 'indice. En el caso de las entradas anal'ogicas, se han adaptado mediante divisores de tensiones para ajustar al l'imite de 2.048V. Para medir las bater'ias se han dispuesto de dos lectura para cada una de las celdas en serie, la primera lectura tiene el fondo de escala a 5V y la segunda a 10V. Para los sensores infrarrojos se han configurado a 3.5V como m'aximo y a 2.2V las dise'nadas para la lectura de la intensidad (midiendo la ca'ida de potencial entre los extremos de una resistencia Shunt). \\

Finalmente las ocho salidas del GPIO se han colocado en un extremo para facilitar su acceso y se ha dispuesto una tira de 4 pines extra para la alimentaci'on y comunicaci'on de los dispositivos que utilizan I${^2}$C.   

\subsubsection{MotorPi}
Esta placa controla la gesti'on de motores e incluye el circuito de monitorizaci'on de la bater'ia. Al contrario que las dos placas anteriormente descritas, la MotorPi no est'a dise'nada para ser encajada encima de otra placa.\\

Se han utilizado bloques de terminales para el cableado de potencia (bater'ia y motores) y tiras de pines para el resto de conexiones separadas en 3 bloques: El primero consiste en una tira de 11 pines pensado para el visualizador led de 10 barras. Un segundo bloque de 10 terminales incorpora los quatro pines de indicaci'on del sentido de giro de los motores, dos para la habilitaci'on de los motores delanteros y cuatro más de lectura de corriente. Finalmente el tercer bloque proporciona la alimentaci'on de l'ogica para los L298, dos pines de habilitaci'on para los motores traseros y sus 4 correspondientes para la lectura de consumo.  

\newpage

\subsection{Conexionado}
Una vez definidos todos los elementos que participan en la modificaci'on de la plataforma rob'otica, es necesario de indicar c'omo se conectan entre ellos. Debido a que cada componente debe ser alimentado a un voltaje específico, se han proyectado diferentes conexionados seg'un la funci'on de sus elementos:

\subsubsection{Potencia}
Este cableado se encarga de la distribuci'on de energ'ia a todos aquellos componentes que est'en dise'nados para aceptar voltajes dentro del rango de la bater'ia. Si nos fijamos en la figura \ref{fig:esquema_power} estos componentes forman dos grupos que se han enmarcado: El grupo encargado de la recarga, formado por el conector ''Power Jack'' y un fusible para proteger la fuente de alimentaci'on exterior, y el grupo encargado del consumo, donde encontramos un interruptor, el switch y los dos circuitos impresos MotorPi y SecurePi.\\

\begin{figure}[ht]
\centering
\includegraphics[scale=0.37]{images/esquema_power.png}
\caption{Esquema el'ectrico del conexionado de potencia}
\label{fig:esquema_power}
\end{figure} 

Aunque el circuito de recarga dispone de fusible, se puede observar que el segundo no. Este hecho se debe a que en la situaci'on de funcionamiento normal, el robot se encuentra en movimiento, el circuito de recarga est'a abierto, por lo que toda la energ'ia la subministra la bater'ia. Y en el caso que una sobrecarga o cortocircuito el propio m'odulo PCM actuar'ia, con lo que no hace necesaria la intalaci'on de un fusible para el circuito de consumo. En cambio, si por casualidad nos encontramos en la situaci'on que tenemos el robot recarg'andose con poca bater'ia y decidimos activar los motores, debido al pico de consumo que aparece se puede dar el caso que sea la fuente qui'en alimente el grupo motor y la acabemos dañando.


\subsubsection{Alimentaci'on de l'ogica}
Una vez la placa SecurePi ha sido alimentada, ofrece una tensi'on de 5V estable. Los consumidores de esta salida son la propia Raspberry Pi, la placa SensorPi y el Router WiFi.

\begin{figure}[ht]
\centering
\includegraphics[scale=0.25]{images/esquema_5V.png}
\caption{Esquema el'ectrico de la alimentaci'on de l'ogica}
\label{fig:esquema_5V}
\end{figure} 

Tanto la Raspberry Pi como la SensorPi no requieren de cableado puesto que su contacto se efect'ua mediante los pines previamente soldados. Por el otro lado, se ha modificado un cable USB tipo A a MicroUSB para ser conectado al GPIO y subministrar energ'ia al Router.

\subsubsection{Cableado SensorPi}

\begin{figure}[ht]
\centering
\includegraphics[scale=0.39]{images/esquema_sensor.png}
\caption{Esquema el'ectrico del cableado de la placa SensorPi}
\label{fig:esquema_sensor}
\end{figure} 

Del mismo modo que la placa SecurePi alimenta a un conjunto de elementos, la placa SensorPi hace lo mismo. Podemos observar la distribuci'on del cableado en la figura \ref{fig:esquema_sensor} y los elementos que dependen de esta placa para funcionar.\\

El conexionado con la placa MotorPi se separa en 3 grupos: Alimentaci'on, comunicaci'on con los controladores y lectura de consumo. El resto de componentes también son alimentados excepto los destinados a la lectura del estado de las celdas de la bater'ia. 

\subsubsection{Comunicaci'on}
Llegados a es este punto tenemos todo lo necesario para que el robot sea capaz de moverse y obtener informaci'on de su entorno, solamente nos queda poder comunicarnos con 'el. Para ello se ha conectado la Raspberry Pi, Router, Switch y la clavija de red externa mediante cables Ethernet. Por otra parte se han extendido las salidas USB de la Raspberry Pi hacia el exterior del robot para facilitar su acceso.

\newpage
\subsection{Distribuci'on interna}
Una vez que los elementos internos del robot han sido definidos, es hora de organizar su distribuci'on. Para ello se han considerados las especificaciones previas, donde se define a grandes rasgos su ubicaci'on preferida. Durante esta fase se ha ido corrigiendo la disposici'on de los elementos hasta encontrar uno que satisface todas las restricciones. Para poder llevar a cabo esta tarea se han modelado todos los componentes en SolidWorks\textregistered, de tal manera que se puede obtener una repressentaci'on gr'afica de su colocaci'on y adem'as poder usar herramientas propias del programa para detectar colisiones o interferencias entre s'olidos.

\subsubsection{Dise'no preliminar}
Puesto que se desea que la parte de procesamiento y comunicaci'on se encuentran en el mismo hemisferio, la colocaci'on de la clavija de Ethernet externa y los dos conectores USB también deber'an estar en el mismo bloque. Siguiendo con el proceso de descarte, el único sensor que se puede colocar en el panel trasero derecho es el infrarrojo, ya que el ultrasonidos ocupar'ia demasiado y haciendo imposible una distribuci'on acorde de los conectores externos. A causa de esta elecci'on quedan fijados en que lugares se distribuyen el resto de sensores.\\

\begin{figure}[ht]
\centering
\includegraphics[scale=0.43]{images/pre_design.png}
\caption{Dise'no preliminar con la ubicaci'on de todos los componentes}
\label{fig:pre_design}
\end{figure} 

Con los conectores y sensores colocados, es el turno de el Switch y la Raspberry Pi. En este caso hab'ian muy pocas combinaciones posibles, haciendo que la preferida fuese aquella que permitiese una f'acil manipulaci'on del cableado m'as fr'agil (los procedentes de la placa SensorPi) y que en caso de problema procedente del sistema operativo, la extracci'on de la SD fuese c'omoda. Finalmente se introdujo el Router, la c'amara se ubicó en el punto m'as centrado y se defini'o la rotaci'on de los motores (los ejes no son colineales al eje central).\\

A continuaci'on se sigui'o con el hemisferio izquierdo. En el panel trasero se ubicaron el interruptor vand'alico, el portafusibles, el encapsulado de 10 leds, el conector para la carga y el sensor de ultrasonidos. Puesto que el uno de los motores se encuentra cerca, la distribuci'on se ha basado en la profundidad a la que llegan estos componentes, de tal manera que se ha evitado cualquier tipo de colisi'on y se ha dejado espacio para el cableado correspondiente. Para terminar se colocaron el placa MotorPi y la bater'ia en la parte inferior de robot y se dejó la IMU en la parte superior para acceder f'acilmente durante el ensamblado, el resultado final se puede apreciar en la figura \ref{fig:pre_design}

\subsubsection{Soportes}
Con todos los elementos ubicados, llegamos al punto de ofrecer un soporte a cada uno.
El objetivo de estos soportes es que sus elementos se unan a los paneles más cercanos y posteriormente unir estos grupos al ensamblaje principal. 

\begin{figure}[ht]
\centering
\includegraphics[scale=0.50]{images/soportes.png}
\caption{Conjunto de soportes orientados para impresi'on 3D}
\label{fig:soportes}
\end{figure} 

Debido a las intrincadas formas que cada uno de los soportes ten'ia que disponer, se opt'o por la impresi'on 3D basada en la superposici'on de material para la fabricaci'on de estos. Este hecho afect'o al dise'no final de los soportes, haciendo que estos se pudiesen fabricar. Un aspecto que se tuvo en cuenta fue la disposici'on de ranuras para las tuercas, haciendo que estas se colocar'an f'acilmente y que no requieran del uso de alicates o llaves para su posterior sujeci'on a la hora de insertar el tornillo.\\ 

Para darle un acabado menos rectangular se dise'naron unos chaflanes, para la colocaci'on de estos se crearon piezas auxiliares con el único ebjetivo de ser unidas al cuerpo principal. Estas piezas auxiliares corresponden a las que se encuentran en los extremos de la figura \ref{fig:soportes} formando dos filas. 

\subsubsection{Dise'no Final}
En esta 'ultima fase se crearon todos los paneles y sus correspondientes orificios par torniller'ia, ejes de motores y paso de cableado. Para mantener la estética original, todos los paneles que forman el robot se ha decidido que sean negros excepto los dos superiores.  

\begin{figure}[ht]
\centering
\includegraphics[scale=0.45]{images/final_design.png}
\caption{Acabado final delantero del robot}
\label{fig:final_design}
\end{figure} 

Para los paneles superiores se ha optado por que sean transparentes, con este cambio se pretende que el usuario tenga una idea de que contiene el robot a primera vista, además de permitir encontrar r'apidamente incidencias por de la falta de indicadores encendidos. 

\begin{figure}[ht]
\centering
\includegraphics[scale=0.43]{images/final_design2.png}
\caption{Acabado final trasero del robot}
\label{fig:final_design2}
\end{figure} 


\newpage
\subsection{Componentes mec'anicos}
El trabajo de ofrecer una estructura donde poder incorporar toda la electr'onica y que permita al robot desplazarse por su entorno recae en la mec'anica. De entre los varios dise'nos posibles se ha elegido aquel que conserve el esp'iritu del robot original, es decir que siga siendo una plataforma constituida por dos partes, que mantenga el concepto de estructura una externa y que su tama'no se respete. A continuaci'on se detallan los diferentes trabajos realizados en este proyecto.  

\subsubsection{Mecanizados}
Como se ha comentado anteriormente, todos los roscados hab'ian sido elaborados con una m'etrica no est'andar. En un primer lugar tenemos los roscados correspondiente a las ocho barras longitudinales de aluminio, unos siete orificios por barra (quatro en una direcci'on y el resto en su perpendicular. Por suerte el di'ametro exterior del roscado era casi id'entico al di'ametro interior de una roscado t'ipico de M3. Gr'acias a este hecho no se requer'ia la necesidad de repasar los orificios con una broca y volver a roscar. Simplemente se volvieron a mecanizar utilizando un macho de roscar.\\

\begin{figure}[ht]
\centering
\includegraphics[scale=0.43]{images/barra.png}
\caption{Modelo por ordenador de una barra longitudinal de aluminio.}
\label{fig:barra}
\end{figure} 

Otro elemento que tambi'en requer'ia de una modificaci'on era los acopladores (couplings) entre la salida del eje del motor y de las ruedas. Estos acopladores, que aparecen en la figura \ref{fig:couplings}, disponen en un extremo un orificio de 6mm de di'ametro pensado para insertar el eje del motor, en el otro extremo se ha mecanizado el cilindro hasta obtener un prisma de base hexagonal (para ofrecer un giro soldiario con la rueda) y en su interior se ha mecanizado una rosca cercana al M4. Perpendicular al eje principal el acoplador dispone de un tercer orificio dise'nado para utilizar un esp'arrago prisionero. Debido al degradado estado de los tornillos y prisioneros, se tuvo que utilizar m'etodos poco convencionales para poder extraerlos. En los tornillos que un'ian la rueda se les practic'o una ranura para poder insertar un destonillador plano, ya que el 'oxido y su cabeza con hueco hexagonal no estandarizado imposibilitaba el uso de llaves Allen. En el caso de los prisioneros, no hubo m'as remedio que realizar un corte con sierra de disco para obtener una ranura, pero para ello se tubo que eliminar parte del aluminio del acoplador.\

\

\begin{figure}[ht]
\centering
\includegraphics[scale=0.43]{images/couplings.png}
\caption{Modelo por ordenador de un acoplador de aluminio.}
\label{fig:couplings}
\end{figure} 

\subsubsection{Paneles}
Una vez dise'nados los paneles que conformar'ian la estructura del robot, se procedi'o a su fabricaci'on. Debido a que en un principio se desconoc'ia que material se utilizar'ia (PVC, Metracrilado, Policarbonato, Acr´ilico, etc.) se decidió usar un grosor típico, f'acil de adquirir y que aportase una resist'encia aceptable. 

\begin{figure}[ht]
\centering
\includegraphics[scale=0.09]{images/paneles.png}
\caption{Conjunto de paneles obtenidos por corte l'aser.}
\label{fig:paneles}
\end{figure} 

Finalmente el material elegido fue el metacrilato, el motivo que hizo decantar la balanza fue saber que era el 'unico que se pod'ia cortar a un precio razonable. Mientras que el resto requer'ian del uso de una fresadora CNC, el metacrilado pod'ia ser trabajado mediante corte l'aser.

\subsubsection{Torniller'ia}
Adem'as de soportar la estructura el objetivo de la nueva torniller'ia que se ha utilizado es que resista mejor las inclemencias de su entorno, por este motivo se ha querido que todos los tornillos sean inoxidables. Adem'as para evitar posibles enredos a la hora de realizar alg'un mantenimiento se han restringido los tipos de tornillos utilizados. De tal manera que para la sujeci'on de los paneles, elementos internos y motores se ha utilizado un tornillo de calidad A2, de cabeza alomanada o DIN 7985 y de  M3x10 o M3x20 seg'un requiera la ocasi'on. Para sujetar la c'amara se han usado el mismo DIN7985 pero de M2x10. Para la uni'on entre el acoplador y la llanta unos DIN912 A2 de M4x10 y para sujetar el acoplador al eje unos esp'arragos DIN 916 de M5x5, estos últimos han tenido que ser de Acero Negro ya que no se han localizado de inoxidables.

\newpage
\subsection{Montaje}
En esta parte se realiza el ensamblado final del robot. El objetivo es crear un sándwich donde los paneles laterales son el continente y los paneles traseros, delanteros, superiores, inferiores y chaflanes el contenido.

\subsubsection{Grupos individuales}
Para ello se unen los paneles interiores verticales con sus tapas inferiores, de esta manera se crea una escuadra de referencia. En una de ellas se colocan el Switch y la Raspberry con las placas SecurePi y SensorPi ya insertadas, el la otra la bater'ia y la placa MotorPi. Por el contrario, en los paneles exteriores verticales se instalan los motores y el sensor de ultrasonidos.\\

En el caso de los paneles delanteros y traseros se unen sus respectivos componentes aprovechando los soportes creados. Excepto la clavija de red, ya que esta forma parte del primer grupo definido. Una vez montados todos los grupos individualmente se realiza un primer cableado de aquellos componentes que su posterior acceso resulte reducido o nulo, concretamente estamos hablando del encapsulado de 10 leds, el conjunto de carga (conector y portafusibles), el interruptor antivand'alico, los sensores de infrarrojos y ultrasonidos y el m'odulo de la c'amara. Llegados a este punto se obtiene el resultado de la figura \ref{fig:montaje}

\begin{figure}[ht]
\centering
\includegraphics[scale=0.12]{images/montaje.png}
\caption{Conjunto de paneles montados individualmente.}
\label{fig:montaje}
\end{figure} 

\subsubsection{Conjunto}
Finalmente se van acoplando los paneles traseros a cada uno de las escuadras creadas y se hace un primer cableado. A continuaci'on se hace pasar la barra roscada que ser'a la que permita la rotaci'on de cada unos de los hemisferios y se coloca un separador de unos 30mm en el medio. Seguidamente se coloca el panel con los motores con cuidado de respetar las tolerancias y evitando enredos con el cableado. Llegados a este punto colocamos los chaflanes, las tuercas de cabeza redondeada en cada extremo de la barra roscada y las tapas superiores. Para acabar colocamos los acopladores en cada uno de los cuatro ejes e insertamos las llantas en su ranura respetando el sentido del perfil del neum'atico.

\begin{figure}[ht]
\centering
\includegraphics[scale=0.17]{images/rospibot_finish.png}
\caption{Acabado final de la plataforma RospiBot.}
\label{fig:rospibot_finish}
\end{figure} 


\newpage
%\subsection{Software}
%Una vez que disponemos de la nueva plataforma, es el turno de volverla operativa. Para ello se han configurado sus componentes y programado varias herramientas. Primero se ha configurado el punto de acceso WiFi. Una vez establecida la conexi'on se ha procedido con el Sistema Operativo. A continuaci'on se han creado programas que se comunican con los periféricos a un bajo nivel y finalmente se ha dise'nado un m'odulo (o librer'ia) para el usuario final. 

\subsection{Configuraci'on Router WiFi}
El router TP-Link WR702N permite operar en vario modos tal y como est'an definidos en el punto \ref{sec:router}. Debido a la necesidad de que tanto la red inal'ambrica como la cableada se puedan comunicar, el único modo posible es que la clavija de red RJ45 est'e configurada como LAN. Adem'as el dispotivo ha de ser capaz de crear su red propia y no depender de otras redes. Por este motivo el modo elegido ha sido el de punto de acceso (o Access Point).\\

La peculiaridad de este punto de acceso es que se ha habilitado el servidor DCHP, lo que permite que cualquier dispositivo que entre en la red se le asigne un IP. Definido el  modo de trabajo, se configura la red inal'ambrica, para ello se ha elegido el nombre de ''\textbf{rospibot}'' como SSID. Para la contrase'na se ha elegido el mismo nombre que la red y protegida mediante el protocolo WPA2.\\

La IP del router asignada ha sido la \textbf{192.168.100.254}, se ha elegido esta numeraci'on para evitar conflictos con las numeraciones m'as utilizadas (192.168.0.XXX y 192.168.1.XXX). Para la asignaci'on del resto de IPs, se ha establecido un rango, desde 192.168.100.101 hasta 192.168.100.199.

\newpage
\subsection{Configuraci'on Raspberry Pi}
Debido a que el disco duro de la Raspberry Pi reside en la SD, y esta puede ser extra'ida sin inconvenientes, la configuraci'on que a continuaci'on se explica se ha efectuado mediante una segunda Raspberry Pi conectada a internet. Una vez finalizada la configuraci'on, se ha insertado la SD de nuevo en el robot (Para tener acceso a la SD se ha de retirar el panel inferior del hemisferio derecho).

\subsubsection{Grabaci'on Raspbian}
El primer paso realizado ha sido la grabaci'on del sistema operativo \textbf{Raspbian}, el m'as extendido en la comunidad (concretamente se ha utilizado la versi'on m'as actual, la de Enero 2014). La imagen de este sistema ocupa un espacio de unos 2.75GB, pero para un correcto funcionamiento se requiere un SD de 4GB mínimo, 8GB recomendado. De los diferentes procedimientos para la obtenci'on de nuestra SD, se ha optado por el programa \textbf{Win32 Disk Imager}. Una vez grabada la SD, en Windows solo aparecerá la partición NTFS de 57MB.

\begin{figure}[ht]
\centering
\includegraphics[scale=1]{images/win32disk.png}
\caption{Interf'icie del programa Win32 Disk Imager.}
\label{fig:win32disk}
\end{figure} 

El sistema operativo de ha obtenido de la p'agina oficial \url{http://www.raspberrypi.org/downloads/} y viene con una cuenta creada con el usuario \textbf{pi} y contrase'na \textbf{raspberry}. Durante toda la realizaci'on del proyecto se ha utilizado esta cuenta de usuario manteniendo su contrase'na. Adem'as de esta dritribuci'on podemos encontrar otros sistemas compatibles con la Raspberry Pi.

\subsubsection{Configuraci'on inicial}
Con la imagen del sistema cargada en la SD, introducimos la tarjeta de memoria en la Raspberry Pi, conectamos el cable de red y alimentamos el conjunto. Al haber activado el servidor DHCP. por defecto el router le asignar'a una IP aleatoria, en este caso seg'un la figura \ref{fig:dhcp}, \textbf(192.168.1.105). Con esta IP nos conectamos mediante SSH . Para ello podemos utilizar diversos m'etodos, en este proyecto se ha usado el comando \textbf{\texttt{ssh pi@192.168.1.105}} en entorno Linux y el programa \textbf{Putty} en Windows. En el caso de Linux, solamente nos pedir'an la contrase'na, en cambio en Windows hay que especificar el puerto 22 y luego el usuario y contrase'na. Una vez hemos accedido v'ia ssh, nos aparecer'a un terminal id'entico al de la figura \ref{fig:ssh}.

\begin{figure}[ht]
\centering
\includegraphics[scale=0.7]{images/dhcp.png}
\caption{Assignaci'on de IP por DHCP.}
\label{fig:dhcp}
\end{figure} 

Una vez dentro de la Raspberry Pi, procedemos a su configuraci'on inicial. Para ello tecleamos el comando \texttt{sudo raspi-config}. A continuaci'on apareceremos en un men'u con diversas opciones como el de la figura \ref{fig:raspiconfig}. Lo primero que haremos ser'a aprovechar el m'aximo la capacidad de nuestra SD con la opci'on \textbf{Expand Filesystem}. Indicaremos que al iniciar no active el modo gr'afico, habilitaremos la c'amara y por 'ultimo, en \textbf{Advanced Options} modificaremos el nombre del dispositivo (o hostname) a ''\textbf{rospibot}''.\\

\begin{figure}[ht]
\centering
\includegraphics[scale=0.8]{images/ssh.png}
\caption{Consola de acceso remotor por SSH.}
\label{fig:ssh}
\end{figure} 

Aunque tambi'en existe la opci'on de aumentar la frecuencia de la CPU hasta 1GHz, de momento se dejar'a con el valor predefinido de 700MHz. En el caso de necesitar una mejora se proceder'a a aumentar progresivamente la frecuencia usando la opcion \textbf{Overclock}. Una vez definidos todos estos cambios se reinicia la placa, iniciando el sistema con la nueva configuraci'on pero teniendo en cuenta que posiblemente la IP sea diferente.

\begin{figure}[ht]
\centering
\includegraphics[scale=0.8]{images/raspiconfig.png}
\caption{Men'u de opciones de configuraci'on de Raspbian.}
\label{fig:raspiconfig}
\end{figure} 

\subsubsection{Instalaci'on de librer'ias}
Con el S.O. Raspbian debidamente configurado procedemos a la instalaci'on de de herramientas, m'odulos y librer'ias. Primero de todo actualizaremos nuestras fuentes con el comando \textbf{\texttt{sudo apt-get update}}, de esta manera sabremos d'onde encontrar aquello que busquemos. A continuaci'on se ir'an detallando aquellas herramientas instaladas.

\begin{itemize}

\item \textbf{\texttt{sudo apt-get install xrdp}}  Permite acceder por entorno gr'afico mediante el uso del Escritorio Remoto de Windows.

\item \textbf{\texttt{sudo apt-get install python-numpy }}  M'odulo de Python, ofrece un mayor soporte para vectores y matrices.

\item \textbf{\texttt{sudo apt-get install python-scipy }}  M'odulo de Python, orientado a optimizaci'on, algebra lineal y procesamiento de se'nales y de imagen entre otros.

\item \textbf{\texttt{sudo apt-get install python-matplotlib }}  M'odulo de Python, permite generar gr'aficos a partir de listas o vectores.

\item \textbf{\texttt{sudo apt-get install python-imaging }} M'odulo de Python, a'nade herramientas para procesamiento de im'agenes.

\item \textbf{\texttt{sudo apt-get install memcached python-memcached}} Programa y m'odulo de Python, permite crear y compartir variables en la memoria cach'e. 
\end{itemize}

Para el uso de bus I2C y SPI que dispone el componente BCM2708, se han de seguir los siguientes pasos: Primero modificamos el archivo \textbf{raspi-blacklist.conf}, para ello ejecutamos el comando \textbf{\texttt{sudo nano /etc/modprobe.d/raspi-blacklist.conf}} y comentamos con una almohadilla los dos dispositivos de la lista. Tal y como aparece en la figura \ref{fig:blacklist}.

\begin{figure}[ht]
\centering
\includegraphics[scale=0.8]{images/blacklist.png}
\caption{Archivo de configuraci'on de los dispositivos I${^2}$C y SPI.}
\label{fig:blacklist}
\end{figure} 

El siguiente paso consiste en modificar el archivo \textbf{modules}, abrimos el archivo con \textbf{\texttt{sudo nano /etc/modules}} y añadimos al final \textbf{i2c-bcm2708} y \textbf{i2c-dev}.

\begin{figure}[ht]
\centering
\includegraphics[scale=0.8]{images/modules.png}
\caption{Archivo de configuraci'on de los m'dulos.}
\label{fig:modules}
\end{figure} 

A continuaci'on instalamos un nuevo grupo de herramientas para el uso de estos dos buses de comunicaci'on:

\begin{itemize}
\item \textbf{\texttt{sudo apt-get install i2c-tools}}  Herramientas y comandos para utilizar el bus I${^2}$C.

\item \textbf{\texttt{sudo apt-get install python-smbus }}  M'odulo de Python, ofrece funciones para trabajar m'as c'omodamente con el bus I${^2}$C.

\item \textbf{\texttt{sudo apt-get install python-dev }}  M'odulo de Python, conjunto de librer'ias est'aticas orientadas al desarrollo. 
\end{itemize}

Ahora s'olo nos hace falta el m'odulo orientado para la comunicaci'on por SPI, en este caso se va a usar un m'odulo creado por un desarrollador independiente. Para ello crearemos una carpeta donde almacenar su c'odigo, lo descargaremos y los instalaremos. Los comandos a ejecutar son:

\begin{itemize}
\item \textbf{\texttt{mkdir python-spi }}
\item \textbf{\texttt{cd python-spi }}
\item \textbf{\texttt{wget https://raw.github.com/doceme/py-spidev/master/setup.py }}
\item \textbf{\texttt{wget https://raw.github.com/doceme/py-spidev/master/spidev$\_$module.c}}
\item \textbf{\texttt{sudo python setup.py install}}
\end{itemize}

Una vez tenemos nuestra Raspberry Pi ya configurada y con las librer'ias instaladas, reiniciamos para que los cambios surtan efecto. 

\newpage
\subsection{Programas b'asicos}
Para que el usuario pueda trabajar c'omodamente con el robot, se han creado un conjunto de programas encargados de comunicarse directamente con los dispositivos. Estos programas se han distribuido en dos carpetas dentro del directorio \textbf{\texttt{/home/pi}}: \textbf{Modules}, incluye todas las librer'ias auxiliares creadas por otros miembros de la comunidad Raspberry Pi, y \textbf{Publishers}, d'onde encontramos los programas que se comunican los dispositivos y almacenan la informaci'on en la memoria cach'e.\\

Todos los c'odigos que aqu'i se mencionan peuden allarse en el repositorio \textbf{GitHub} de este proyecto, \url{https://github.com/Guasch5000/RosPiBot}. A continuaci'on se detallan los programas ubicados en la carpeta  \textbf{Publishers}, cual es su funci'on, que par'ametros intervienen y de que manera almacena la informaci'on.

\begin{itemize}
\item \textbf{\texttt{readsensors.py}} Este m'odulo se encarga de la lectura de los sensores que se comunican por el bus I${^2}$C, donde encontramos la lectura del estado de la bater'ia, la de corriente de cada motor, los dos sensores de dist'ancia por infrarrojos, los cuatro por ultrasonidos y la imu. Debido a que cada sensor requiere de ser muestreado a frecuencias diferentes, lo primero que encontramos en el c'odigo es una tabla para definir estos valores en segundos. Seguidamente se definen las direcciones de cada dispositvo y se declaran las funciones de lectura.\\

La lectura de los sonars se publica en mil'imetros debido a que esa es su resoluci'on, con un m'aximo de 5192mm. Por el contrario los infrarrojos se publican en cent'imetros, siendo su m'aximo valor de 1,51cm. En el caso de la bater'ia, se ha pasado su voltaje a un procentaje, siendo 6V el 0\% y 8,3V el 100\%. Para los sensores de corriente, se almacena el valor en miliamperios, con un m'aximo de 4000mA. Finalemente, los valores procedentes de la imu se han almacenado seg'un se han recibido, las acceleraciones en G (9,8m$\cdot$s$^{-2}$), las velocidades angulares en rad${\cdot}$s$^{-1}$ y la orientaci'on en radianes.\\

\item \textbf{\texttt{readencoders.py}} Dise'nado para comunicarse con los descodificadores de cuadratura. Puesto que almacenar el recorrido de cada rueda no es 'util para sistemas no hol'onomos, este programa recoge el recuento de cada codificador y mediante una diferencia se extrae la velocidad de cada motor delantero. Para estandarizar los valores, estos se almacenar'an en radianes por segundo, el sentido positivo indica que la rueda ejerce una movimiento hacia adelante.\\

\item \textbf{\texttt{movemotors.py}} A partir de dos variables almacenadas en la memoria cache (speed$\_$l, speed$\_$r) con un rango de valores de -100 hasta 100, se genera se'nales PWM para cada motor. El sentido de giro de los motores es el mismo para cada lado, debido que hacer girar las ruedas de un mismo hemisferio en sentidos contrarios implica contraponer los dos motores y desaprovechar la energ'ia.\\

\item \textbf{\texttt{readjoystick.py}} Este 'ultimo programa se espera a que el mando inal'ambrico F710 de Logitech est'e conectando y envi'e se'nal. Una vez conectado el programa lee los eventos generados por el mando y modifica la los registros de la cache relacionados con la velocidad de los motores. Para poder conducir el robot mediante el mando es necesario mantener el bot'on \textbf{LB}, luego con el joystick izquierdo se controla el sentido de ir adelante o atr'as, por el contrario, con el derecho se controla el sentido de rotaci'on.

\end{itemize}


\newpage
\subsection{M'odulo Rospibot}
Puesto que el objetivo de este proyecto es ofrecer una plataforma rob'otica con las herramientas necesarias para trabajar con ella, se ha creado el m'odulo \textbf{rospibot} de python para poder interaccionar con todas las variables del sistema. Dicho m'odulo se encuentra alojado en el directorio \textbf{Modules} (junto otras librer'ias).\\

Para importar este m'odulo desde cualquier ubicaci'on se ha modificado la variable de entorno \textbf{PYTHONPATH}, a'nadiendo el directorio \textbf{/home/pi/Modules} a dicha variable. Para ello se ha ejecutado el comando \textbf{\texttt{export PYTHONPATH=\$PYTHONPATH:/home/pi/Modules}}. Con este cambio cualquier usuario puede importar los nuevos m'odulos, excepto el usuario \textbf{root}. Para que el usuario root tambi'en pueda hacer uso, se ha editado el archivo \textbf{/etc/sudoers} y se ha incorporado la l'inea \textbf{\texttt{Define env$\_$keep += \$PYTHONPATH}}. A continuaci'on se detallan todas la funciones que forman el m'odulo rospibot, estas funciones simplemente sirven de enlace con la memoria cache:\\

\begin{itemize}
\item \textbf{\texttt{get$\_$sonar$\_$front()}} Devuelve en mil'imetros la lectura del sensor de distancia por ultrasonidos orientado hacia adelante. Del mismo modo, para el sensor trasero deberemos cambiar \textbf{$\_$front()} por \textbf{$\_$back()}, \textbf{$\_$left()} para el izquierdo y \textbf{$\_$right()} para el derecho.

\item \textbf{\texttt{get$\_$orientation()}} Devuelve en radianes un vector de tres posiciones correspondiente a la orientaci'on respecto el suelo. El primer valor corresponde al ''pitch'' o rotaci'on respecto el eje $y$, el segundo al ''roll'', rotaci'on respecto $x$ y el 'ultimo al ''yaw' , eje $z$. \\

\item \textbf{\texttt{get$\_$acce()}} Devuelve en G (9.8m$\cdot$s$^{-2}$) las aceleraciones de cada eje, siguiendo el orden $x$, $y$ y $z$.\\

\item \textbf{\texttt{get$\_$acce()}} Devuelve en radianes por segundo la velocidad angular de cada eje siguiendo el mismo orden que la funci'on anterior.\\

\item \textbf{\texttt{get$\_$infrared$\_$front()}} Devuelve en cent'imetros la distancia de un obt'aculo a partir del sensor de infrarrojos. Del mismo modo que los sonars, para lalectura del sensor trasero 'unicamente se deber'a modificar \textbf{$\_$front()} por \textbf{$\_$back()}.\\

\item \textbf{\texttt{get$\_$battery()}} Devuelve en tanto por ciento (un n'umero entero) el estado de la bater'ia.\\

\item \textbf{\texttt{get$\_$current$\_$left$\_$front()}} Devuelve en miliamperios el consumo de corriente del motor delantero izquierdo. Para el motor delantero derecho \textbf{\texttt{$\_$right$\_$front()}} y para los traseros \textbf{\texttt{$\_$left$\_$back()}} y \textbf{\texttt{$\_$right$\_$back()}}.\\

\item \textbf{\texttt{get$\_$rads$\_$left()}}: Devuelve en radianes por segundo la velocidad de la rueda delantera izquierda. En condiciones de experimentaci'on se ha observado que el valor m'aximo en carga es de aproximadamente unos 7rad${\cdot}$s$^{-1}$. En el caso de querer conocer la velocidad de la otra  rueda, deberemos cambiar \textbf{$\_$left()} por \textbf{$\_$right()}-.\\

\item \textbf{\texttt{set$\_$speed(left$\_$speed, right$\_$speed)}} Al contrario que el resto de funciones, esta se encarga de modificar el registro. para ello ser'a obligatorio definir las dos velocidad con un valor de entre -100 y 100. La velocidad aplicada por el usuario puede no corresponder con la real puesto que se trata de un control de lazo abierto.\\

\end{itemize}


\newpage
\subsection{Instalaci'on ROS Groovy}
La peculiaridad de este robot respecto otros es el hecho que en su interior puede ejecutarse un n'ucleo de ROS (roscore). Otras plataformas recurren a un ''int'erprete'' entre la informaci'on que procedente de la plataforma y el formato aceptado por ROS. Esta caracter'istica permite que el robot funcione independientemente de un ordenador externo a la hora de trabajar con ROS.\\

De las versiones existentes en la realizaci'on del proyecto, s'olo hab'ian dos posibilidades, \textbf{Groovy} o \textbf{Hydro} (la distribuci'on de Indigo a'un se encontraba en desarrollo). De entra las dos versiones disponibles se elegi'o Groovy debido a que ofreci'a soporte directo a Raspbian.\\

Este proyecto finaliza con la instalaci'on y configuraci'on de ROS Groovy en la plataforma RosPiBot. Puesto que las variables del robot se pueden acceder con el m'odulo creado, no aparece la necesidad de crear t'opicos que publiquen esta informaci'on. A'un así, puede convertirse en un primer contacto con ROS para futuros usuarios. A continuaci'on se detallan los pasos realizados, aunque estos pasos ya quedan explicados en la p'agina \url{http://wiki.ros.org/groovy/Installation/Raspbian}, existe una diferencia que puede conllevar problemas si se desea realizar los tutoriales. Por ello se eplica todo el proceso hasta la  creaci'on del paquete ''beginner$\_$tutorials'' incluido.\\

\subsubsection{Instalaci'on b'asica}
\begin{itemize}
\item \textbf{\texttt{sudo sh -c $'$echo ''deb http://64.91.227.57/repos/rospbian wheezy main'' > \
/etc/apt/sources.list.d/rospbian.list$'$}}
\item \textbf{\texttt{wget http://64.91.227.57/repos/rospbian.key -O - | sudo apt-key add -}}
\item \textbf{\texttt{sudo apt-get update}}
\item \textbf{\texttt{sudo apt-get install ros-groovy-ros-comm}}\\
\end{itemize}

\subsubsection{Inicializar dependencias y librer'ias}
\begin{itemize}
\item \textbf{\texttt{sudo rosdep init}}
\item \textbf{\texttt{rosdep update}}
\item \textbf{\texttt{echo ''source /opt/ros/groovy/setup.bash'' $>>$ ~/.bashrc}}
\item \textbf{\texttt{source ~/.bashrc}}
\item \textbf{\texttt{sudo apt-get install python-rosinstall}}
\item \textbf{\texttt{sudo apt-get install ros-groovy-ros-tutorials}}\\
\end{itemize}

\subsubsection{Creaci'on directorio de trabajo}
\begin{itemize}
\item \textbf{\texttt{mkdir -p ~/ROS/catkin$\_$ws/src}}
\item \textbf{\texttt{cd ~/ROS/catkin$\_$ws/src}}
\item \textbf{\texttt{catkin$\_$init$\_$workspace}}
\item \textbf{\texttt{cd ~/ROS/catkin$\_$ws}}
\item \textbf{\texttt{catkin$\_$make}}
\item \textbf{\texttt{source devel/setup.bash}}\\
\end{itemize}

\subsubsection{Creaci'on paquete ''beginner$\_$tutorials''}
\begin{itemize}
\item \textbf{\texttt{cd ~/ROS/catkin$\_$ws/src}}
\item \textbf{\texttt{catkin$\_$create$\_$pkg beginner$\_$tutorials std$\_$msgs rospy roscpp}}
\item \textbf{\texttt{catkin$\_$make -DCMAKE$\_$BUILD$\_$TYPE=Release}}
\item \textbf{\texttt{catkin$\_$make install}}
\item \textbf{\texttt{catkin$\_$make install -DCMAKE$\_$INSTALL$\_$PREFIX=/opt/ros/groovy}}
\item \textbf{\texttt{echo ''source /home/pi/ROS/catkin$\_$ws/devel/setup.bash'' $>>$ ~/.bashrc}}
\item \textbf{\texttt{source ~/.bashrc}}\\
\end{itemize}

\newpage
\section{Presupuesto}
El coste total de este proyecto asciende hasta los \textbf{5139,69 euros}. El material utilizado implica unos \textbf{523,69 euros} (un 10,2\% del coste total) y el coste personal unos \textbf{4616,00 euros} (el 89,8\% restante). A continuaci'on se detallan los costes del proyecto.

\subsection{Coste Material}
De los 523,69 euros invertidos en este proyecto para la adquisici'on de material, se han distribuido seg'un la tabla \ref{tab:coste material}. En los siguiente sub-apartados se define los componentes.

\begin{table}[H]
\begin{center}
\begin{tabular}{|l|r|r|}
	\hline
	\textbf{Concepto} & \textbf{Coste [\euro]} & \textbf{Porcentaje} \\ \hline
	Dispositivos & 234.05 & 44.7 \\ \hline
	Electr'onica & 112.59 & 21.5 \\ \hline
	Mec'anica & 106.63 & 20.4 \\ \hline
	SecurePi & 25.49 & 4.9 \\ \hline
	SensorPi & 24.10 & 4.6 \\	\hline
	MotorPi & 20.83 & 4.0 \\ \hline
	\textbf{Total} & \textbf{523,69} & \textbf{100,0} \\ \hline
\end{tabular}
\end{center}
\caption{Distribuci'on del presupuesto de material}
\label{tab:coste material}
\end{table}

\subsubsection{Coste de Dispositivos}

\begin{table}[H]
\begin{center}
\begin{tabular}{|l|r|r|r|}
	\hline
	\textbf{Concepto} & \textbf{Coste unitario} & \textbf{Unidades} & \textbf{Total [\euro]}\\
	 \hline
	Raspberry Pi tipo B & 40,96 & 1 & 40,96 \\ \hline
	M'odulo c'amara & 28,92 & 1 & 28,92 \\ \hline	
	SD 8GB & 7,19 & 1 & 7,19 \\ \hline	
	Mando Logitech F710 & 60,44 & 1 & 60,44 \\ \hline	
	Router TL-WR720N & 21,68 & 1 & 21,68 \\ \hline
	Cable Ethernet Cat5 & 2,30 & 3 & 6,90 \\ \hline
	Extensor Ethernet & 3,96 & 1 & 3,96 \\ \hline
	Extensor USB & 2.12 & 2 & 4,24 \\ \hline
	Sonar KS103 & 11,50 & 4 & 46,00 \\ \hline
	IMU GY-80 & 13,79 & 1 & 13,79 \\ \hline
	\textbf{Total} &  &  & \textbf{234,05} \\ \hline
\end{tabular}
\end{center}
\caption{Coste detallado de cada dispositivo}
\label{tab:coste dispositivos}
\end{table}

\subsubsection{Coste de la Electr'onica}
\begin{table}[H]
\begin{center}
\begin{tabular}{|l|r|r|r|}
	\hline
	\textbf{Concepto} & \textbf{Coste unitario} & \textbf{Unidades}& \textbf{Total [\euro]} \\ \hline
	
	Bater'ia LiPo 7,4V 11.000mAh & 78,59 & 1 & 78,59\\ \hline
	Interruptor antivand'alico & 11,49 & 1 & 11,49\\ \hline
	Barra 10 leds & 8,05 & 1 &  8,05\\ \hline
	Portafusible & 3,87 & 1 & 3,87\\ \hline
	Cableado & 10,59 & 1 & 10,59\\ \hline
	\textbf{Total} &  &  & \textbf{112,59} \\ \hline


\end{tabular}
\end{center}
\caption{Coste detallado de la electr'onica}
\label{tab:coste electronica}
\end{table}

\subsubsection{Coste placa SecurePi}
\begin{table}[H]
\begin{center}
\begin{tabular}{|l|r|r|r|}
	\hline
	\textbf{Concepto} & \textbf{Coste unitario} & \textbf{Unidades}& \textbf{Total [\euro]} \\ \hline
	
	PCB SecurePi & 1,94 & 1 & 1,94\\ \hline
	Regulador LM2596S-5.0 & 4,22 & 1 & 4,22\\ \hline
	Diodo Schottky 50V 4A & 0,52 & 1 & 0,52\\ \hline
	Bobina 22uH & 1,11 & 1 & 1,11\\ \hline
	Condensador 680uF electrol'itico & 0,92 & 1 & 0,92\\ \hline
	Condensador 220uF electrol'itico & 0,73 & 1 & 0,73\\ \hline
	Resist'encia 10Kohms SMD 1206 & 0,005 & 32 & 0,15\\ \hline
	Mosfet BSS138 & 0,21 & 16 & 3,36\\ \hline
	Conector barrel Jack 5.2mm & 2,51 & 1 & 2,51\\ \hline
	Conector Hembra 18x2 pines & 4,84 & 1 & 4,84\\ \hline
	Conector Hembra 8 pines & 1,14 & 1 & 1,14\\ \hline
	Conector Hembra 5 pines & 0,91 & 1 & 0,91\\ \hline
	Conector Hembra 4 pines & 0,82 & 1 & 0,82\\ \hline
	Conector Hembra 3 pines & 0,77 & 1 & 0,77\\ \hline
	Conector Hembra 2 pines & 0,73 & 1 & 0,73\\ \hline
	Conector Macho 13x2 pines & 0,53 & 1 & 0,53\\ \hline
	\textbf{Total} &  &  & \textbf{25,49} \\ \hline

\end{tabular}
\end{center}
\caption{Coste detallado placa SecurePi}
\label{tab:coste securepi}
\end{table}

\subsubsection{Coste de la Mec'anica}
\begin{table}[H]
\begin{center}
\begin{tabular}{|l|r|r|r|}
	\hline
	\textbf{Concepto} & \textbf{Coste unitario} & \textbf{Unidades}& \textbf{Total [\euro]} \\ \hline
	
	Paneles Metacrilato & 99,75 & 1 & 99,75\\ \hline
	DIN 912 INOX A4 4x10 & 0,23 & 4 & 0,92\\ \hline
	DIN 913 5x5 & 0,10 & 4 & 0,40\\ \hline
	DIN 934 M2 & 0,07 & 2 & 0,14\\ \hline
	DIN 934 M3 & 0,04 & 80 & 3,2\\ \hline
	DIN 1587 M8 & 0,91 & 2 & 1,82 \\ \hline
	DIN 7985 A2 3x10 & 0,03 & 102 & 3,06\\ \hline
	DIN 7985 A4 3x20 & 0,05 & 11 & 0,55\\ \hline
	\textbf{Total} &  &  & \textbf{106,63} \\ \hline

\end{tabular}
\end{center}
\caption{Coste detallado de la mec'anica}
\label{tab:coste mecanica}
\end{table}

\subsubsection{Coste placa SensorPi}
\begin{table}[H]
\begin{center}
\begin{tabular}{|l|r|r|r|}
	\hline
	\textbf{Concepto} & \textbf{Coste unitario} & \textbf{Unidades}& \textbf{Total [\euro]} \\ \hline
	
	PCB SensorPi & 1,94 & 1 & 1,94\\ \hline
	Led 'ambar & 0,11 & 8 & 0,88\\ \hline
	Led verde & 0,05 & 1 & ','5\\ \hline
	Resist'encia 1Mohms 1/4W SMD 1206 & 0,01 & 2 & 0,02\\ \hline
	Resist'encia 10Kohms 1/4W SMD 1206 & 0,005 & 12 & 0,06\\ \hline
	Resist'encia 6,9Kohms 1/4W SMD 1206 & 0,007 & 4 & 0,03\\ \hline
	Resist'encia 2,49Kohms 1/4W SMD 1206 & 0,008 & 2 & 0,02\\ \hline
	Resist'encia 1Mohms 1/4W SMD 1206 & 0,01 & 2 & 0,02\\ \hline
	Resist'encia 1Mohms 1/4W SMD 1206 & 0,01 & 2 & 0,02\\ \hline
	Condensador 10uF 10V cer'amico SMD 1206 & 0,19 & 2 & 0,38\\ \hline
	Condensador 0,1uF 10V cer'amico SMD 1206 & 0,03 & 2 & 0,06\\ \hline
	Condensador 18pF 50V cer'amico SMD 1206 & 0,06 & 2 & 0,12\\ \hline
	Integrado MCP3424 ADC Delta-Sigma SOIC & 3,79 & 2 & 7,58\\ \hline
	Cristal 40MHz 30ppm & 0.53 & 2 & 1,06\\ \hline
	Integrado LS7366S descodificador SOIC & 4,23 & 2 & 8,46\\ \hline
	Conector macho 8 pin largo & 1,05 & 3 & 3,15\\ \hline
	Conector macho 40 pin & 0,24 & 1 & 0,24\\ \hline
	\textbf{Total} &  &  & \textbf{24,10} \\ \hline

\end{tabular}
\end{center}
\caption{Coste detallado placa SensorPi}
\label{tab:coste securepi}
\end{table}

\subsubsection{Coste placa MotorPi}
\begin{table}[H]
\begin{center}
\begin{tabular}{|l|r|r|r|}
	\hline
	\textbf{Concepto} & \textbf{Coste unitario} & \textbf{Unidades}& \textbf{Total [\euro]} \\ \hline
	
	PCB MotorPi & 1,94 & 1 & 1,94\\ \hline
	Integrado LM3914 & 2,34 & 1 & 2,34\\ \hline
	Resist'encia 10Kohms 1\% DIP & 0,03 & 2 & 0,06\\ \hline
	Resist'encia 11Kohms 1\% DIP & 0,03 & 1 & 0,03\\ \hline
	Resist'encia 13Kohms 1\% DIP & 0,10 & 1 & 0,10\\ \hline
	Resist'encia 1Kohms SMD 1206 & 0,007 & 4 & 0,03\\ \hline
	Resist'encia Shunt 0,5Ohms 2W SMD & 1,91 & 4 & 4,74\\ \hline
	Condensador 1uF 16V Ceramico & 0,06 & 1 & 0,06\\ \hline
	Bloque Terminal doble & 0,38 & 5 & 1,90\\ \hline
	Diodo Schottky 40V 5A & 0,29 & 4 & 1,17\\ \hline
	Driver L298P & 4,24 & 2 & 8,48\\ \hline	
	\textbf{Total} &  &  & \textbf{20,83} \\ \hline

\end{tabular}
\end{center}
\caption{Coste detallado placa MotorPi}
\label{tab:coste motorpi}
\end{table}

\newpage
\subsection{Coste Personal}
Aunque en un proyecto de este tipo el presupuesto en personal no influyen en el gasto total, es recomendable conocer en que cantidades rondar'ia el proyecto si fuese de 'ambito comercial. Para realizar dicha contabilidad se ha segmentado el coste personal seg'un su labor\\

\begin{table}[H]
\begin{center}
\begin{tabular}{|l|r|r|r|}
	\hline
	\textbf{Labor} & \textbf{Coste horario [\euro /h]} & \textbf{Horas}& \textbf{Total [\euro]} \\ \hline
	
	Estudio de viabilidad & 40 & 53 & 2.120\\ \hline
	Dise'no circuito impreso & 26 & 12 & 312\\ \hline
	Dise'no asistido por ordenador & 24 & 22 & 528\\ \hline
	Soldadura PCB & 18 & 4 & 72\\ \hline
	Montaje y cableado & 16 & 14 & 224\\ \hline
	programaci'on & 20 & 68 & 1.360\\ \hline
	\textbf{Total} &  &  & \textbf{4.616} \\ \hline

\end{tabular}
\end{center}
\caption{Coste detallado del personal necesario}
\label{tab:coste personal}
\end{table}

\subsubsection{Descripci'on de las labores}

\begin{itemize}
\item \textbf{Estudio de viabilidad}  Analizar el producto WifiBot, buscar mejoras, localizar nuevo componentes que ofrezcan mayor utilidad y estudiar su compatibilidad entre ellos.

\item \textbf{Dise'no Circuito Impreso} Encontrar la mejor distribuci'on de los componentes encontrados en el estudio de viabilidad, de tal manera que su producci'on sea f'acil para sus distribuidores y montadores.

\item \textbf{Dise'no Asistido por ordenador} Ubicar los diferentes componentes dentro del robot, realizar un modelo por ordenador de todos los componentes y Dise'nar el resultado final.

\item \textbf{Soldadura de PCB} Montaje de las placas que conforman el proyecto y comprobaci'on de su funcionamiento.

\item \textbf{Montaje y Cableado} Unificaci'on de todos los elementos que forman el robot, rectificaci'on de roscas y acabado final.
 
\item \textbf{Programaci'on} Configuraci'on del sistema operativo, creaci'on de programas para la comunicaci'on con los diferentes dispotivos y de un conjunto de librer'ias para mejorar la comodidad al usuario.
\end{itemize}

\newpage
\section{Impacto Ambiental}

\newpage
\section{Conclusiones}

\newpage
\section{Soporte inform'atico}

\newpage
\section{Agradecimientos}

\newpage
%\section{Bibliografia}
\addcontentsline{toc}{section}{Referencias}
\begin{thebibliography}{a}
\bibitem{pradery} \textsc{Montero, J.},
\textit{Metodos matemáticos aplicados a la ganadería.}
Sevilla: Ediciones de la pradera, 2007  
\bibitem{old} \textsc{Old, L.},
\textit{Confesiones de una oveja bizca}
Madrid: Naturalistic, 2010 
\end{thebibliography}

\end{document}
